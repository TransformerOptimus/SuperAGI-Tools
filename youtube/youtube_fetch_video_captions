from superagi.tools.base_tool import BaseTool
from pydantic import BaseModel, Field
from typing import Type
from helper.youtube_helper import YoutubeHelper


class YoutubeFetchCaptionsSchema(BaseModel):
    video_link: list = Field(..., description="Link of video whose captions are to be fetched")


class YoutubeFetchCaptionsTool(BaseTool):
    """
    Youtube fetch video captions Tool
    """
    name: str = "Youtube fetch video captions Tool"
    args_schema: Type[YoutubeFetchCaptionsSchema] = YoutubeFetchCaptionsSchema
    description: str = "Tool for fetching the captions of a youtube video"

    def _execute(self, video_link: str = None):
        """
        Execute the Youtube fetch video captions tool

        Args:
            video_link: Link of video whose captions are to be fetched

        Returns:
            List: Video transcript, if fetched successfully, otherwise an error message
        """
        if not video_link:
            raise ValueError("At least one argument must be provided")

        youtube_key = self.get_tool_config('YOUTUBE_KEY')
        youtube_helper = YoutubeHelper(youtube_key)

        # Getting the video id
        video_id = youtube_helper.get_video_id(video_link)

        # Making the request
        request = youtube_helper.youtube_request_video_captions(videoId=video_id)
        videos_info = request

        print("Videos' transcript fetched successfully")
        return videos_info
